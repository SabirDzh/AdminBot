import re
import asyncio
from aiogram import *
from aiogram.enums import ParseMode
from aiogram.handlers import callback_query
from aiogram.types import *
from aiogram.filters import *
from aiogram.fsm.context import *
from aiogram.fsm.state import *
from aiogram.exceptions import *
from datetime import date

from click import help_option

from AdminBot.src.Keyboards import *
from aiogram.enums.chat_member_status import ChatMemberStatus
from aiogram.exceptions import TelegramBadRequest
from datetime import datetime, timedelta
import asyncpg
from AdminBot.src.Database.models import *
from telethon.sync import TelegramClient
from telethon.tl.functions.channels import GetParticipantsRequest
from telethon.tl.types import ChannelParticipantsRecent
from AdminBot.src.handlers.checks import *
import logging


router = Router()

@router.message(F.text.startswith("/helps"))
async def cmd_helps_command(message: Message):
    command_help = {
        "id": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID —Å–≤–æ–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/id"
        },
        "start": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ì–æ–≤–æ—Ä–∏—Ç –±–æ—Ç—É –æ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/start"
        },
        "help": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–í—ã–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –ª—Å",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/help"
        },
        "rules": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ï—Å—Ç—å –ø—Ä–∞–≤–∏–ª–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤—ã –º–æ–∂–µ—Ç–µ –µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–∞ –ª—é–±–æ–µ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ, –º–∏–Ω–∏–º—É–º –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤, –∏–Ω–∞—á–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/rules"
        },
        "status": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/status"
        },
        "ban": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ù–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å—Ä–∞–∑—É –≤—ã–¥–∞–µ—Ç –±–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞, –Ω–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —á–µ–π —Å—Ç–∞—Ç—É—Å –≤ –≥—Ä—É–ø–ø–µ –≤—ã—à–µ –∏–ª–∏ —Ä–∞–≤–µ–Ω –≤–∞—à–µ–º—É",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/ban"
        },
        "unban": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–†–∞–∑–±–∞–Ω–∏–≤–∞–µ—Ç –∏–≥—Ä–æ–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –Ω–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–∞–π —Å—Ç–∞—Ç—É—Å –≤ –≥—Ä—É–ø–ø–µ –≤—ã—à–µ –∏–ª–∏ —Ä–∞–≤–µ–Ω –≤–∞—à–µ–º—É",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/unban"
        },
        "mute": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–õ–∏—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∞–≤ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è, —Ñ–æ—Ç–∫–∏, —Å—Ç–∏–∫–µ—Ä—ã –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—Ä–µ–º—è, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è, –∏–Ω–∞—á–µ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/mute 1h"
        },
        "unmute": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∏—Å–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–∫–∏, —Å—Ç–∏–∫–µ—Ä—ã –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ –Ω–∞–¥–æ",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/unmute"
        },
        "warn": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–í—ã–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –º–∞–∫—Å–∏–º—É–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π 3, –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 3-–≥–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–¥–∞–µ—Ç—Å—è –±–∞–Ω, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —É–º–µ–Ω—å—à–∞—é—Ç—Å—è –Ω–∞ 1 –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/warn"
        },
        "unwarn": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ö–æ–º–∞–Ω–¥–∞ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –Ω–∞ 1 —É —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–Ω—è—Ç—å –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤–ø–∏—Å—ã–≤–∞–µ—Ç–µ –∏—Ö —á–∏—Å–ª–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/warn 1"
        },
        "stat": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏, –¥–æ—Å—Ç—É–ø–Ω–æ –∑–∞ –Ω–µ–¥–µ–ª—é, –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/stat"
        },
        "activ": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤ —Å–µ—Ç–∏, –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–∏—Å–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–µ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/activ"
        },
        "total_warn": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è, –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ª–∏–±–æ –≤ –≥—Ä—É–ø–ø–µ, –ª–∏–±–æ –≥–ª–æ–±–∞–ª—å–Ω–æ, —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/total_warn"
        },
        "chatID": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å ID –≥—Ä—É–ø–ø—ã, –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –≥—Ä—É–ø–ø—É –æ–ø—Ä–æ—Å–∞",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/chatID"
        },
        "all": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–û—Ç–º–µ—á–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥—Ä—É–ø–ø—ã, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ç–æ—Ä–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å 10 —Ç—ã—Å—è—á",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/all"
        },
        "language": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ú–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫, —Å—Ä–µ–¥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π, –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∞–Ω–≥–ª–∏–π—Å–∫–∏–π",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/language english"
        },
        "kick": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–∫–∏–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –≥—Ä—É–ø–ø—ã, –Ω–æ –Ω–µ –∑–∞–±–∞–Ω–∏—Ç—å, –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å–ø—É—Å—Ç—è 30 —Å–µ–∫—É–Ω–¥ –ø–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ, –≤—Ä–µ–º—è —Ç–æ–∂–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/kick"
        },
        "poll": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–ø—Ä–æ—Å–∞ –≤ –≥—Ä—É–ø–ø—É, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ID –≥—Ä—É–ø–ø—ã, –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –Ω–µ–µ –æ–ø—Ä–æ—Å, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø—Ä–æ—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ª—Å, –≥–ª–∞–≤–Ω—ã–π –ø–ª—é—Å –≤ —Ç–æ–º —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ–ø—Ä–æ—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ –∑–∞–≤—Ç—Ä–∞",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/poll"
        },
        "cancel": {
            "–û–ø–∏—Å–∞–Ω–∏–µ": "–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥—ã /poll",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ": "/cancel"
        },
    }

    parts = message.text.strip().split()
    if len(parts) < 2:
        await message.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /helps <–∏–º—è –∫–æ–º–∞–Ω–¥—ã>")
        return

    cmd = parts[1].lower()
    help_info = command_help.get(cmd)

    if help_info:
        response = (
            f"üìò <b>–ö–æ–º–∞–Ω–¥–∞</b>: <b>/{cmd}</b>\n\n"
            f"üìù <b>–û–ø–∏—Å–∞–Ω–∏–µ</b>: {help_info['–û–ø–∏—Å–∞–Ω–∏–µ']}\n"
            f"üìé <b>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</b>: {help_info["–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ"]}"
        )
    else:
        response = (
            f"üôÅ –ö–æ–º–∞–Ω–¥–∞ <b>{cmd}</b> –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
        )

    await message.answer(text=response,
                         parse_mode="HTML")








